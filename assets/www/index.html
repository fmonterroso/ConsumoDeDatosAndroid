<!DOCTYPE HTML> 
<html>
   <head>
      <title>Consumo de Datos</title>
      <script type="text/javascript" charset="utf-8" src="js/cordova-2.5.0.js"></script>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet"  href="css/jquery.mobile-1.3.1.css">
      <link rel="stylesheet" type="text/css" href="css/tolito-1.0.4.css" />
      <link rel="stylesheet"  href="css/main.css">
      <link rel="stylesheet" type="text/css" href="css/jquery.confirm.css" />
      <link href="css/dcaccordion.css" rel="stylesheet" type="text/css" />
      <link href="css/layout.css" rel="stylesheet" type="text/css" />
      <script src="js/jquery.js"></script>
      <script src="js/jquery.mobile-1.3.1.js"></script>
      <script src="js/PluginCom.js"></script>
      <script src="js/md5.js"></script>
      <script type="text/javascript" src="js/tolito-1.0.4.js"></script>
      <script type='text/javascript' src='js/jsapi.js'></script>
      <script src="js/jquery.confirm.js"></script>
      <script type='text/javascript' src='js/jquery.dcjqaccordion.2.7.js'></script>
      <script type='text/javascript' src='js/jquery.cookie.js'></script>
      <script src="js/funciones.js"></script>
      <script>
         // Wait for Cordova to load
            document.addEventListener("deviceready", onDeviceReady, false);
         
            //variables de control (banderas)
            var currentId="";
            var currentIdAlarm="";
            var bandera_eliminar="0";
            var bandera_paquete="0";
            var bandera_existen_numeros="0";
         
         //Valores por defecto de variables
            var vigencia = "";
            var mbtotales = "0";
            var mbconsumidos = "0";
            var nombrepaq = "N/A";
            var numtelefonico = "";
            var cont_paquetes = 0;
         
            var nombre_usuario = "";
         
            function drawChart() {}
            try
           {
         	google.load('visualization', '1.0', {'packages':['gauge']});
         	google.setOnLoadCallback(drawChart);
           }
         catch(err)
           {
           	//alert("Error al cargar los graficos"+err);
           	console.log("No se pudo cargar la librería para graficos.");
           }
            
         
         $( document ).on( "pageshow", function(){
         	//$("#ConsumodeDatos").hide().delay( 1500 ).show( "fast" );
         	//$("#DEMO").hide().delay( 1500 ).show( "fast" );
         
         	
         });
         
         function onDeviceReady() {
             // Now safe to use the Cordova API
             
             //Agregando controlador del boton ATRAS
             document.addEventListener("backbutton", handleBackButton, true);
         
             //Abriendo Base de datos
             var db = abrirBD();
             
             
             //Cargando librerias para el grafico de Gauge
             if(navigator.connection.type == Connection.NONE){
                 // No tenemos conexión			        
                 console.log("No tenemos conexión");
             }else{
                 // Si tenemos conexión
                 console.log("Si tenemos conexión");
             }
         
         
             //Recorrer datos y mostrar
          			consultaInicial();
          			
          			//Consulta buscando el numero principal si no fue establecido al inicio    			
          			if (currentId == ""){
          				//no se inserto un numero al inicio
          				//realizando busqueda del principal
          				consultaPrincipal();    				
          			}else{
          				consultaDatosPaquete();
          			}
         }
         
         
         // Aqui se carga la funcion cuando se carga completament el arbol DOm de nuestra pagina index.html
         $(document).ready(function(){
         
         	
         
         });//fin de document ready
         
      </script>
   </head>
   <body>
      <div id="Datos" data-url="Datos" data-role="page">
         <div data-role="header" data-position="fixed">
            <div data-role="navbar">
               <ul class="accordion accordion-1" id="mainmenu">
                  <li>
                     <a class="menuitemMenu dcjq-current-parent" href="#" data-icon="grid" data-role="button" data-iconpos="notext"></a>
                     <ul>
                        <li><a class="submenuitem menuitemHistorial" href="#" style="width: 200px;">Mira tu historial</a></li>
                        <br>
                        <br>
                        <li><a class="submenuitem menuitemContacto" href="#" style="width: 200px;">Contacto</a></li>
                        <br>
                        <li><a class="submenuitem menuitemTerminos" href="#" style="width: 200px;">Terminos y condiciones</a></li>
                        <br>
                        <li><a class="submenuitem menuitemSalir" href="#" style="width: 200px;">Salir</a></li>
                     </ul>
                  </li>
                  <li><a class="menuitemHome ui-btn-active" href="#" data-icon="home" data-role="button" data-iconpos="notext"></a></li>
                  <li><a class="menuitemStore" href="#" data-icon="star" data-role="button" data-iconpos="notext"></a></li>
                  <li><a class="menuitemConfig" href="#" data-icon="gear" data-role="button" data-iconpos="notext"></a></li>
               </ul>
               <script type="text/javascript">
                  $('.accordion-1').dcAccordion({
                      eventType: 'click',
                      autoClose: true,
                      saveState: true,
                      disableLink: true,
                      speed: 'fast',
                      showCount: false,
                      autoExpand: false,
                      cookie  : '',
                      classExpand  : ''
                  });
               </script>
            </div>
            <!-- /navbar -->
         </div>
         <!-- /header -->			
         <div data-role="content">
            <div id="user_name">
               Usuario
            </div>
            <script type="text/javascript">
               //Consultando datos del usuario
               			consultarUsuarioBD();
            </script>
            <br/>
            <div id="central-content">
               <span>
                  <div id="dateAndTime" style="font-size: 12px; font-weight: bold; !important;"></div>
               </span>
               <div id='chart_div' class="center-wrapper"></div>
               <a href="#popupBasic" data-rel="popup">
                  <div id="progressbar"></div>
               </a>
               <div data-role="popup" id="popupBasic">
                  <p>
                  <div id="mbConsumedBar" style="font-weight: bold;"></div>
                  <p>
               </div>
               <div id="totalpercentage" style="float:right; font-size:12px;"></div>
               <br/>				
               <span class="greyText">
                  <div data-role="fieldcontain">
                     <span>Detalle de consumo:</span><br/>										
                     <span>Al día</span>
                     <span id="dateDetalle"></span>
                     <br/>
                     <span >a las</span>
                     <span id="timeDetalle" 	></span>
                     <br/>
                  </div>
               </span>
               <!-- Script para fecha y hora actual-->
               <script type="text/javascript">
                  //conversion de fecha acutal
                  	var ahora = new Date( );
                  	var fech = mostrarFechaCompuestaDias(ahora);
                  	var hora = mostrarHoraCompuesta(ahora);
                  	$("#dateDetalle").append("&nbsp;"+fech);					
                  	$("#timeDetalle").append("&nbsp;"+hora);
               </script>
               <div data-role="fieldcontain" class="stripedRow odd">
                  <div class="txtdato">Incluidos</div>
                  <DIV id="txtimginc" class="datoimg" ></DIV>
               </div>
               <div data-role="fieldcontain" class="stripedRow even">
                  <div class="txtdato">Consumidos</div>
                  <DIV id="txtimgcons" class="datoimg" ></DIV>
               </div>
               <div data-role="fieldcontain" class="stripedRow odd">
                  <div class="txtdato">Disponibles</div>
                  <DIV id="txtimgdisp" class="datoimg" ></DIV>
               </div>
               <div data-role="fieldcontain" class="stripedRow even">
                  <div class="txtdato">% disponible</div>
                  <DIV id="txtimgporc" class="datoimg" ></DIV>
               </div>
               <!-- Script para Datos-->
               <script type="text/javascript">
                  if (parseInt(mbtotales) > 0)
                  	var porcentaje = Math.round((parseInt(mbconsumidos)*100)/parseInt(mbtotales));
                  else
                  	var porcentaje = 0;				
                  
                  $("#txtimginc").append(mbtotales+" MB");
                  $("#txtimgcons").append(mbconsumidos+" MB");
                  
                  var dispo = parseInt(mbtotales)-parseInt(mbconsumidos);
                  $("#txtimgdisp").append(dispo+" MB");
                  $("#txtimgporc").append(porcentaje+"%");
               </script>
               <div data-role="fieldcontain" class="stripedRow odd">
                  <span>Paquete vigente al</span>
                  <br>
                  <span id="dateVigenciaDetalle" style="font-weight: bold; !important;"></span>
               </div>
               <div data-role="fieldcontain" class="stripedRow even">
                  <div style="float:left;">Tu número: &nbsp;</div>
                  <div id="phoneNum" style="font-weight: bold; !important;"></div>
               </div>
               <br/>
               <div style="float:left;">Tienes &nbsp;</div>
               <div id="numPaqRemaining">&nbsp;</div>
               <!-- Script para vigencia-->
               <script type="text/javascript">
                  //conversion de fecha de vigencia
                  if (bandera_paquete == "1"){
                  	//fech = Date.parse(vigencia);
                  	fech = parseDate(vigencia);
                  	//alert("parseada:"+fech);
                  	fech2 = new Date(fech);
                  	//alert("como fecha:"+fech2);
                  	fech3 = mostrarFechaCompuesta(fech2);
                  	//alert("aplicada funcion:"+fech3);
                  	$("#dateVigenciaDetalle").append(fech3);
                  }else
                  	$("#dateVigenciaDetalle").append("N/A");
                  
                  
               </script>				
               <!-- Fin de contenido de detalle de consumo-->
            </div>
         </div>
      </div>
   </body>
</html>